# spring面向切面编程
面向方面程序设计(AOP)通过提供另一种考虑程序结构的方法来补充面向对象程序设计(OOP)。OOP中模块性的关键单元是类，而AOP中模块性的单元是方面。
方面支持跨多个类型和对象的关注点(如事务管理)的模块化。(在AOP文献中，这样的关注点通常被称为“横切”关注点。)

Spring的关键组件之一是AOP框架。虽然Spring IoC容器不依赖于AOP(这意味着如果您不想使用AOP，就不需要使用AOP)，但AOP对Spring IoC进行了补充，提供了一个非常强大的中间件解决方案。

> ## spring Aop使用AspectJ切入点
> Spring通过使用基于模式的方法或@AspectJ注释风格提供了编写自定义方面的简单而强大的方法。这两种风格都提供了完全类型的通知和AspectJ切入点语言的使用，同时仍然使用Spring AOP进行编织。
> 
> 本章讨论基于模式和@ aspectj的AOP支持。下一章将讨论底层AOP支持。

在Spring框架中使用AOP来实现

* 提供声明式企业服务。此类服务中最重要的是声明式事务管理。
* 让用户实现自定义方面，用AOP补充他们对OOP的使用。

> 如果您只对通用的声明性服务或其他预先打包的声明性中间件服务(如池)感兴趣，那么您不需要直接使用Spring AOP，可以跳过本章的大部分内容。

## AOP 概念
让我们从定义一些核心的AOP概念和术语开始。这些术语并不是spring特有的。不幸的是，AOP术语不是特别直观。但是，如果Spring使用自己的术语，就更令人困惑了。

* Aspect:跨多个类的关注点的模块化。事务管理是企业级Java应用程序中横切关注点的一个很好的例子。在Spring AOP中，方面是通过使用常规类(基于模式的方法)或使用
  @Aspect注释的常规类(@AspectJ风格)来实现的。
* Join point:程序执行期间的一个点，例如方法执行或异常处理期间的一个点。在Spring AOP中，连接点总是表示方法执行。
* Advice:方面在特定连接点上采取的操作。不同类型的建议包括“周围”、“之前”和“之后”的建议。(稍后讨论通知类型。)许多AOP框架(包括Spring)将通知建模为拦截器，并围绕连接点维护拦截器链。
* Pointcut:匹配连接点的谓词。通知与切入点表达式相关联，并在切入点匹配的任何连接点上运行(例如，具有特定名称的方法的执行)。由切入点表达式匹配的连接点的概念是AOP的核心，Spring在默认情况下使用AspectJ切入点表达式语言。
* Introduction:代表类型声明其他方法或字段。Spring AOP允许向任何被建议的对象引入新的接口(以及相应的实现)。例如，您可以使用一个介绍来让一个bean实现一个IsModified接口，以简化缓存。(在AspectJ社区中，介绍称为类型间声明。)
* Target object:由一个或多个方面通知的对象。也称为“建议对象”。因为Spring AOP是通过使用运行时代理实现的，所以这个对象始终是一个代理对象。
* AOP proxy:AOP框架为了实现方面契约(通知方法的执行等等)而创建的对象。在Spring框架中，AOP代理是JDK动态代理或CGLIB代理。
* Weaving:将方面与其他应用程序类型或对象链接以创建已通知对象。这可以在编译时(例如使用AspectJ编译器)、加载时或运行时完成。与其他纯Java AOP框架一样，Spring AOP在运行时执行编织。

Spring AOP包括以下类型的通知
* before advice:在连接点之前运行但不能阻止执行流继续到连接点的通知(除非它抛出异常)。
* 返回通知后:通知将在连接点正常完成后运行(例如，如果方法返回时没有抛出异常)。
* 抛出通知后:如果方法通过抛出异常而退出，则将运行通知。
* 通知之后(最后):无论连接点以何种方式退出(正常或异常返回)，都要运行的通知。
* 环绕通知:围绕连接点(如方法调用)的通知。这是最有力的建议。Around通知可以在方法调用之前和之后执行自定义行为。它还负责选择是继续到连接点，还是通过返回自己的返回值或抛出异常来简化建议的方法的执行。

Around advice是最常见的一种建议。由于Spring AOP像AspectJ一样提供了完整的通知类型，所以我们建议您使用功能最弱的通知类型来实现所需的行为。
例如，如果您只需要用方法的返回值更新缓存，那么最好实现一个after return advice，而不是around advice，尽管around advice可以完成同样的事情。
使用最特定的通知类型可以提供更简单的编程模型，出错的可能性更小。例如，您不需要在用于around通知的JoinPoint上调用proceed()方法，
因此，您不会无法调用它。

所有通知参数都是静态类型的，这样您就可以使用适当类型的通知参数(例如，从一个方法执行返回值的类型)，而不是对象数组。

由切入点匹配的连接点的概念是AOP的关键，这将它与只提供拦截的旧技术区别开来。切入点使通知能够独立于面向对象的层次结构作为目标。
例如，您可以应用around通知，为一组跨越多个对象(如服务层中的所有业务操作)的方法提供声明性事务管理。